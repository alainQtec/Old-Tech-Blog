<!-- forestryio: ignore; forestryio: admin -->
<!-- This is just a ui to scare people away // since forestry won't allow unknown account to view the site dashboard -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="noindex" />
  <title>alainQtec authv2</title>
  <meta name="description" content=" " />
  <meta name="author" content=" " />
  <meta name="HandheldFriendly" content="true" />
  <meta name="MobileOptimized" content="320" />
  <!-- Use maximum-scale and user-scalable at your own risk. It disables pinch/zoom. Think about usability/accessibility before including.-->
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

  <!-- Fort awesome icon kit -->
  <script src="https://use.fortawesome.com/b6f38602.js"></script>
  <link rel="shortcut icon" href="{{site.url}}{{site.baseurl}}/assets/img/logo/favicon.png" type="image/x-icon">
  <link rel="icon" href="{{site.url}}{{site.baseurl}}/assets/img/logo/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel="stylesheet" href="{{site.url}}{{site.baseurl}}/assets/css/admin.css">
  <!-- for netlify cms: <link href="https://unpkg.com/netlify-cms/dist/cms.css" rel="stylesheet" /> -->
  <!-- <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> -->
</head>

<body>
  <!-- <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/cms.js"></script> -->
  <!-- <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script> -->
  <form id="app" class="ui-modal" data-state="idle" autocomplete="off">
    <div class="ui-icon">
      <div class="ui-lock"></div>
    </div>
    <div class="ui-title">Admin CMS</div>
    <div class="ui-subtitle">
      <span data-show="idle">
        Please enter your password to continue.
      </span>
      <span data-show="validating">
        Validating...
      </span>
      <span data-show="error" class="ui-error">
        Invalid password
      </span>
      <span data-show="success">
      </span>
      <!-- TODO: div#app should always be hidden untill  span.data-show="success" -->
    </div>
    <div class="ui-password">
      <input type="password" name="" id="" class="ui-password-input" placeholder="Enter your passkey to continue." />
    </div>
    <button class="ui-submit">Submit</button>
    <button class="ui-reset" type="button" title="Reset"></button>
  </form>
  <script src='https://unpkg.com/xstate@next/dist/xstate.js'></script>
  <script>
    console.clear();
    const elApp = document.querySelector("#app");
    const elButton = document.querySelector(".ui-submit");
    const elPassword = document.querySelector(".ui-password-input");
    const elReset = document.querySelector(".ui-reset");

    const context = {
      password: ""
    };


    const actions = {
      assignPassword: XState.assign({
        password: (_, event) => event.value
      }),

      validatePassword: ctx => {
        setTimeout(() => {
          // This is just for show this is not my real forestry password ðŸ˜ŽðŸš§.
          if (ctx.password === "9874_forestry_cms") {
            send("VALID");
            // $.getScript("{{site.url}}{{site.baseurl}}/assets/js/forestry_login.js");
            var env = {
              siteId: "mufuojwz6nnomg",
              local: false
            };

            function uuidv4() {
              return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
              });
            }

            var uuid = uuidv4()
            var script = document.createElement('script');
            script.src = "https://app.forestry.io/admin/forestry.min.js?hash=" + uuid
            script.id = "forestry-admin";
            document.body.appendChild(script);

            var link = document.createElement("link");
            link.type = "text/css";
            link.rel = "stylesheet";
            link.href = "https://app.forestry.io/admin/main.css?hash=" + uuid
            document.head.appendChild(link);
          } else {
            send("INVALID");
          }
        }, 2000);
      },

      clearPassword: XState.assign({
        password: () => {
          elPassword.value = '';
          return '';
        }
      })
    };



    const passwordMachine = XState.Machine(
      {
        initial: "idle",
        context,
        states: {
          idle: {
            entry: "clearPassword",
            on: {
              SUBMIT: { target: "validating", cond: "passwordEntered" },
              CHANGE: {
                target: "idle",
                actions: "assignPassword",
                internal: true // this prevents onEntry from running again
              }
            },

            initial: 'normal',
            states: {
              normal: {},
              error: {
                after: {
                  2000: "normal"
                }
              }
            }
          },




          validating: {
            onEntry: "validatePassword",
            on: {
              VALID: "success",
              INVALID: "idle.error"
            }
          },


          success: {}
        },

        on: {
          RESET: ".idle"
        }
      },


      {
        actions,
        guards: {
          passwordEntered: ctx => {
            return ctx.password && ctx.password.length;
          }
        }
      });




    let state = passwordMachine.initialState;

    function activate(state) {
      elApp.dataset.state = state.toStrings().join(' ');

      document.querySelectorAll("[data-active]").forEach(el => {
        el.removeAttribute("data-active");
      });

      document.querySelectorAll(`[data-show~="${state.value}"]`).forEach(el => {
        el.setAttribute("data-active", true);
      });
    }

    const interpreter = XState.
      interpret(passwordMachine).
      onTransition(activate).
      start();

    activate(state);

    const { send } = interpreter;

    elButton.addEventListener("click", () => send("SUBMIT"));
    elPassword.addEventListener("input", (e) =>
      send({ type: "CHANGE", value: e.target.value }));

    elApp.addEventListener("submit", e => {
      e.preventDefault();
      send("SUBMIT");
    });
    elReset.addEventListener("click", () => send("RESET"));
  </script>
</body>

</html>